<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MSSU NCR-CL PERSONNEL STATUS</title>
<button onclick="printReport()">ðŸ–¨ Print Report</button>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f2f5ff;
    margin: 0;
  }
  header {
    background: #004aad;
    color: white;
    text-align: center;
    padding: 1em;
    font-size: 1.3em;
  }
  main {
    padding: 1em;
    max-width: 1200px;
    margin: auto;
  }
  nav button {
    margin: 4px;
    padding: 8px 16px;
    border: none;
    background: #e0e0e0;
    border-radius: 5px;
  }
  nav button.active {
    background: #004aad;
    color: white;
  }
  section {
    display: none;
    background: white;
    padding: 1em;
    border-radius: 8px;
    margin-top: 1em;
    box-shadow: 0 0 5px rgba(0,0,0,0.1);
  }
  section.active { display: block; }
  table {
    width: 100%;
    border-collapse: collapse;
  }
  th, td {
    border: 1px solid #ccc;
    padding: 6px;
    text-align: left;
  }
  th {
    background: #004aad;
    color: white;
  }
  input, select, textarea {
    font-size: .9em;
    padding: 4px;
    width: 100%;
    margin: 3px 0;
  }
  button.action {
    background: #004aad;
    color: white;
    border: none;
    padding: 6px 10px;
    border-radius: 4px;
  }
  button.action:hover { background: #00337a; }
  .tallyBox {
    margin-top: 8px;
    padding: 6px;
    background: #e9eefc;
    border-radius: 5px;
  }
  #summaryBox {
    background: white;
    padding: 1em;
    border-radius: 8px;
    margin-top: 1em;
    box-shadow: 0 0 5px rgba(0,0,0,0.1);
  }
  @media print {
    nav, #inputForm, .actionBtns { display:none; }
    section { box-shadow:none; border:none; }
    #summaryBox { page-break-before: always; }
  }
</style>
</head>
<body>
<header><b>MSSU NCR-CL PERSONNEL STATUS</b></header>
<main>
  <nav>
    <button class="tabBtn active" data-tab="mssu">MSSU</button>
    <button class="tabBtn" data-tab="ds">Detached Status</button>
    <button class="tabBtn" data-tab="psc">PSC Division</button>
  </nav>

  <div id="inputForm">
    <h3>Add / Edit Personnel</h3>
    <div class="grid">
      <input id="itemNo" placeholder="Item #" />
      <input id="name" placeholder="Full Name" />
      <input id="designation" placeholder="Designation / Rank" />
      <input id="photoURL" placeholder="Photo URL (optional)" />
      <select id="unitType">
        <option value="mssu">MSSU</option>
        <option value="ds">Detached Status</option>
        <option value="psc">PSC Division</option>
      </select>
      <select id="pscSubDivision" style="display:none;">
        <option value="PSC Div Bataan">PSC Div Bataan</option>
        <option value="PSC Div SH">PSC Div SH (South Harbor)</option>
        <option value="PSC Div NH">PSC Div NH (North Harbor)</option>
        <option value="PSC Div Subic">PSC Div Subic</option>
      </select>
      <select id="status">
        <option>On Duty</option>
        <option>Rest & Recreation Leave</option>
        <option>Mandatory Leave</option>
        <option>Sick Leave</option>
        <option>Official Business</option>
        <option>Under Instruction</option>
        <option>Schooling (Local)</option>
        <option>Schooling (Foreign)</option>
        <option>Training (Local)</option>
        <option>Training (Foreign)</option>
      </select>
      <input id="from" type="date" placeholder="From Date" />
      <input id="to" type="date" placeholder="To Date" />
      <input id="remarks" placeholder="Remarks / Authority" />
      <select id="action">
        <option>Active (Organic)</option>
        <option>Active (DS)</option>
        <option>Transferred</option>
        <option>Retired</option>
      </select>
      <input id="soiFileLink" placeholder="SOI File Link (PDF or DOC URL)" />
    </div>
    <button class="action" onclick="addRecord()">Save Record</button>
  </div>

  <section id="mssu" class="active">
    <h3>MSSU Personnel</h3>
    <table id="mssuTable">
      <thead><tr><th>Item</th><th>Photo</th><th>Name</th><th>Designation</th><th>Status</th><th>Duration</th><th>Remarks</th><th>Action</th><th>SOI</th></tr></thead>
      <tbody></tbody>
    </table>
    <div id="mssuTally" class="tallyBox"></div>
  </section>

  <section id="ds">
    <h3>Detached Status Personnel</h3>
    <table id="dsTable">
      <thead><tr><th>Item</th><th>Photo</th><th>Name</th><th>Designation</th><th>Status</th><th>Duration</th><th>Remarks</th><th>Action</th><th>SOI</th></tr></thead>
      <tbody></tbody>
    </table>
    <div id="dsTally" class="tallyBox"></div>
  </section>

  <section id="psc">
    <h3>PSC Division Personnel</h3>
    <table id="pscTable">
      <thead><tr><th>Item</th><th>Photo</th><th>Name</th><th>PSC SubDivision</th><th>Status</th><th>Duration</th><th>Remarks</th><th>Action</th><th>SOI</th></tr></thead>
      <tbody></tbody>
    </table>
    <div id="pscTally" class="tallyBox"></div>
  </section>

  <h2>Summary of All Personnel</h2>
  <div id="summaryBox"></div>
<button id="sendDataBtn">ðŸ“¤ Send / Save Data</button>
</main>

<script>
const scriptURL = https://script.google.com/macros/s/AKfycbyHZIncOuTxv_-zAufcMj8SarVXzHRZOooKENAmuHD4Ruu3oWHrJfOGbnH8tSl0iTOQRg/exec;

let records = { mssu: [], ds: [], psc: [] };

// Tab switching
document.querySelectorAll('.tabBtn').forEach(btn => {
  btn.onclick = () => {
    document.querySelectorAll('.tabBtn').forEach(b=>b.classList.remove('active'));
    document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById(btn.dataset.tab).classList.add('active');
    document.getElementById('unitType').value = btn.dataset.tab;
    document.getElementById('pscSubDivision').style.display =
      btn.dataset.tab === 'psc' ? 'inline-block' : 'none';
    displayRecords();
  };
});

// Add record
function addRecord() {
  const newRecord = {
    itemNo: itemNo.value,
    photoURL: photoURL.value,
    name: name.value,
    designation: designation.value,
    unitType: unitType.value,
    pscSubDivision: pscSubDivision.value,
    status: status.value,
    from: from.value,
    to: to.value,
    remarks: remarks.value,
    action: action.value,
    soiFileLink: soiFileLink.value
  };

  records[newRecord.unitType].push(newRecord);
  displayRecords();

  fetch(scriptURL, {method:'POST', body: JSON.stringify(newRecord)}).catch(err=>console.log(err));
  document.querySelectorAll('#inputForm input').forEach(i=>i.value='');
}

// Load from Google Sheet
fetch(scriptURL)
  .then(r=>r.json())
  .then(rows=>{
    // Skip header row
    rows.slice(1).forEach(row=>{
      if(!row[0]) return;
      const rec={
        itemNo:row[0],photoURL:row[1],name:row[2],designation:row[3],
        unitType:row[4],pscSubDivision:row[5],status:row[6],
        from:row[7],to:row[8],remarks:row[9],action:row[10],soiFileLink:row[11]
      };
      records[rec.unitType].push(rec);
    });
    displayRecords();
  });

// Display function
function displayRecords(){
  ['mssu','ds','psc'].forEach(type=>{
    const tbody=document.querySelector(`#${type}Table tbody`);
    tbody.innerHTML='';
    let total=0,onDuty=0,leave=0,train=0,retired=0;
    records[type].forEach(r=>{
      total++;
      if(r.status.includes('Duty')) onDuty++;
      if(r.status.includes('Leave')) leave++;
      if(r.status.includes('School')||r.status.includes('Training')) train++;
      if(r.action.includes('Retired')) retired++;
      const tr=document.createElement('tr');
      tr.innerHTML=`
        <td>${r.itemNo}</td>
        <td>${r.photoURL?'<img src="'+r.photoURL+'" width="40">':'â€”'}</td>
        <td>${r.name}</td>
        <td>${r.unitType==='psc'?r.pscSubDivision||'â€”':r.designation||'â€”'}</td>
        <td>${r.status}</td>
        <td>${r.from||''}â€“${r.to||''}</td>
        <td>${r.remarks||''}</td>
        <td>${r.action}</td>
        <td>${r.soiFileLink?'<a href="'+r.soiFileLink+'" target="_blank">ðŸ“„</a>':'â€”'}</td>`;
      tbody.appendChild(tr);
    });
    document.getElementById(type+'Tally').innerHTML=
      `<b>Total:</b> ${total} | On Duty: ${onDuty} | On Leave: ${leave} | Schooling/Training: ${train} | Retired: ${retired}`;
  });

  const grand = records.mssu.length + records.ds.length + records.psc.length;
  document.getElementById('summaryBox').innerHTML =
    `<b>Total MSSU:</b> ${records.mssu.length} | <b>DS:</b> ${records.ds.length} | <b>PSC:</b> ${records.psc.length} | <b>Grand Total:</b> ${grand}`;
}
function printReport() {
  const inputs = document.querySelectorAll('input, textarea, button');
  inputs.forEach(i => i.style.display = 'none'); // hide input elements
  window.print();
  inputs.forEach(i => i.style.display = ''); // restore inputs after printing
}
</script>
</body>
</html>